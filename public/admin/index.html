<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex" />
    <title>Panel de Administración - Daniel Publicidad</title>
    
    <!-- Favicon -->
    <link rel="icon" href="/logo.png" type="image/png" />
    
    <!-- Netlify Identity -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    
    <!-- CSS Personalizado -->
    <link rel="stylesheet" href="/admin/custom.css" />
  </head>
  <body>
    <!-- Netlify CMS -->
    <script src="https://unpkg.com/netlify-cms@^2.10.192/dist/netlify-cms.js"></script>
    
    <script>
      // Configuración personalizada del CMS
      CMS.registerPreviewStyle('/admin/custom.css');
      
      // Inicialización personalizada
      CMS.init({
        config: {
          load_config_file: true
        }
      });
      
      // Agregar logo al header después de que cargue el CMS
      function addLogoToHeader() {
        // Buscar el header
        const header = document.querySelector('[class*="AppHeader-"]') || 
                      document.querySelector('header') ||
                      document.querySelector('[role="banner"]');
        
        if (header && !document.getElementById('admin-logo')) {
          // Crear contenedor del logo
          const logoContainer = document.createElement('div');
          logoContainer.id = 'admin-logo-container';
          logoContainer.style.cssText = `
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-right: auto;
          `;
          
          // Crear imagen del logo
          const logo = document.createElement('img');
          logo.id = 'admin-logo';
          logo.src = '/logo.png';
          logo.alt = 'Daniel Publicidad';
          logo.style.cssText = `
            height: 50px;
            width: auto;
            object-fit: contain;
          `;
          
          // Crear texto del header
          const title = document.createElement('div');
          title.style.cssText = `
            display: flex;
            flex-direction: column;
          `;
          title.innerHTML = `
            <h1 style="
              color: white !important;
              font-size: 1.5rem !important;
              font-weight: 700 !important;
              margin: 0 !important;
              line-height: 1.2 !important;
            ">Daniel Publicidad</h1>
            <p style="
              color: rgba(255, 255, 255, 0.8) !important;
              font-size: 0.875rem !important;
              margin: 0 !important;
            ">Panel de Administración</p>
          `;
          
          logoContainer.appendChild(logo);
          logoContainer.appendChild(title);
          
          // Insertar al principio del header
          header.insertBefore(logoContainer, header.firstChild);
        }
      }
      
      // Intentar agregar el logo cuando el DOM esté listo
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          setTimeout(addLogoToHeader, 1000);
          // Reintentar cada 2 segundos por si el CMS tarda en cargar
          const interval = setInterval(() => {
            if (document.querySelector('[class*="AppHeader-"]')) {
              addLogoToHeader();
              clearInterval(interval);
            }
          }, 2000);
        });
      } else {
        setTimeout(addLogoToHeader, 1000);
        const interval = setInterval(() => {
          if (document.querySelector('[class*="AppHeader-"]')) {
            addLogoToHeader();
            clearInterval(interval);
          }
        }, 2000);
      }
      
      // Limpiar caché si hay errores
      if (window.localStorage) {
        const hasError = window.location.hash.includes('error');
        if (hasError) {
          console.log('Limpiando caché del CMS...');
          Object.keys(localStorage).forEach(key => {
            if (key.includes('netlify-cms') || key.includes('decap-cms')) {
              localStorage.removeItem(key);
            }
          });
          window.location.hash = '';
          window.location.reload();
        }
      }
    </script>
  </body>
</html>
