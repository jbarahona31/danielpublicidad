<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex" />
    <title>Panel de Administraci√≥n - Daniel Publicidad</title>
    
    <!-- Netlify Identity -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    
    <!-- CSS Personalizado -->
    <link rel="stylesheet" href="/admin/custom.css" />
    
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        margin: 0;
        padding: 0;
      }
      
      /* Estilos para el logo custom */
      .admin-logo-container {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem 2rem;
        background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      }
      
      .admin-logo {
        height: 50px;
        width: auto;
      }
      
      .admin-title {
        color: #1f2937;
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0;
      }
    </style>
  </head>
  <body>
    <!-- Netlify CMS -->
    <script src="https://unpkg.com/netlify-cms@^2.10.192/dist/netlify-cms.js"></script>
    
    <script>
      // Esperar a que el CMS cargue
      window.addEventListener('DOMContentLoaded', function() {
        
        // Funci√≥n para agregar el logo
        function addCustomLogo() {
          // Buscar el header del CMS
          const header = document.querySelector('[class*="AppHeader"]') || 
                        document.querySelector('header') ||
                        document.querySelector('[role="banner"]');
          
          if (header && !header.querySelector('.admin-logo-container')) {
            // Guardar elementos interactivos existentes
            const existingButtons = Array.from(header.querySelectorAll('button, a[href]'));
            
            // Limpiar contenido existente del header
            header.innerHTML = '';
            
            // Crear contenedor personalizado
            const logoContainer = document.createElement('div');
            logoContainer.className = 'admin-logo-container';
            
            // Agregar logo
            const logo = document.createElement('img');
            logo.src = '/logo.png';
            logo.alt = 'Daniel Publicidad';
            logo.className = 'admin-logo';
            
            // Agregar t√≠tulo
            const title = document.createElement('h1');
            title.className = 'admin-title';
            title.textContent = 'Panel de Administraci√≥n';
            
            logoContainer.appendChild(logo);
            logoContainer.appendChild(title);
            header.appendChild(logoContainer);
            
            // Restaurar elementos interactivos si existen
            existingButtons.forEach(btn => header.appendChild(btn));
            
            // Aplicar estilos al header
            header.style.background = 'linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)';
            header.style.boxShadow = '0 4px 20px rgba(0, 0, 0, 0.1)';
            header.style.padding = '0';
          }
        }
        
        // Funci√≥n para personalizar iconos de categor√≠as
        function customizeCollectionIcons() {
          const collectionLinks = document.querySelectorAll('[class*="CollectionLink"]');
          
          collectionLinks.forEach(link => {
            const text = link.textContent.toLowerCase();
            let icon = 'üìÅ';
            
            if (text.includes('uniforme')) icon = 'üëï';
            else if (text.includes('gorra')) icon = 'üß¢';
            else if (text.includes('posillo') || text.includes('vaso')) icon = '‚òï';
            else if (text.includes('estampado')) icon = 'üé®';
            
            // Agregar icono si no existe
            if (!link.querySelector('.category-icon')) {
              const iconSpan = document.createElement('span');
              iconSpan.className = 'category-icon';
              iconSpan.textContent = icon;
              iconSpan.style.fontSize = '1.5rem';
              iconSpan.style.marginRight = '0.75rem';
              link.insertBefore(iconSpan, link.firstChild);
            }
          });
        }
        
        // Observador para detectar cambios en el DOM
        const observer = new MutationObserver(function(mutations) {
          addCustomLogo();
          customizeCollectionIcons();
        });
        
        // Configurar el observador
        observer.observe(document.body, {
          childList: true,
          subtree: true
        });
        
        // Ejecutar inmediatamente
        setTimeout(addCustomLogo, 100);
        setTimeout(addCustomLogo, 500);
        setTimeout(addCustomLogo, 1000);
        setTimeout(customizeCollectionIcons, 100);
        setTimeout(customizeCollectionIcons, 500);
        setTimeout(customizeCollectionIcons, 1000);
        
        // Ejecutar cada vez que cambie la ruta
        window.addEventListener('hashchange', function() {
          setTimeout(addCustomLogo, 100);
          setTimeout(customizeCollectionIcons, 100);
        });
      });
      
      // Limpiar cach√© si hay errores
      if (window.localStorage) {
        const hasError = window.location.hash.includes('error');
        if (hasError) {
          console.log('Limpiando cach√© del CMS...');
          Object.keys(localStorage).forEach(key => {
            if (key.includes('netlify-cms') || key.includes('decap-cms')) {
              localStorage.removeItem(key);
            }
          });
          window.location.hash = '';
          window.location.reload();
        }
      }
      
      // Configuraci√≥n del CMS despu√©s de cargar
      if (window.CMS) {
        // Registrar preview styles
        CMS.registerPreviewStyle('/admin/custom.css');
      }
    </script>
  </body>
</html>
